/*! epicTail 2013-09-24 */
"use strict";var worker=this,instance=!1;worker.addEventListener("message",function(a){instance?instance.updateOpts(a):new epicTail(a)},!1);var epicTail=function(a){var b=this,c=a.data||{};this.target=a.target||"",this.file=a.data.file||!1,this.defaults={},this.defaults.string=!1,this.defaults.interval=3e3,this.defaults.minBlobSize=100,this.defaults.fBeg=0,this.defaults.showFailed=!1,this.defaults.matchAll=!1,this.defaults.escapeText=!1,this.defaults.callback=function(){},this.opts=this.extend(b.defaults,c),this.reader=new FileReader,this.post=worker.postMessage,this.opts.fBeg=this.file.size-.1*this.file.size<this.opts.minBlobSize?this.file.size-.1*this.file.size:this.file.size-this.opts.minBlobSize,this.fBeg=this.opts.fBeg,this.fEnd,instance=this,this.file?this.read():function(){throw JSON.stringify("no file")}};epicTail.prototype.read=function(){var a,b=this;setInterval(function(){b.fEnd=b.file.size-1,a=b.file.slice(b.fBeg,b.fEnd+1),b.reader.readAsText(a),b.reader.onloadend=function(){if(2===b.reader.readyState){switch(b.opts.action){case"match":b.match(b.reader.result);break;case"stop":b.close();break;default:worker.postMessage(b.reader.result)}b.fBeg=b.fEnd+1}}},b.opts.interval)},epicTail.prototype.match=function(a){for(var b,c=this,d=a.split(/\r?\n/),e=new RegExp(c.opts.query,"g"),f=0;f<d.length;f++)if(this.opts.query&&""!==this.opts.query&&void 0!==this.opts.query)if(b=d[f].match(e),null!==b&&0!==b.length)if(c.opts.escapeText?d[f]=c.html(d[f]):"",c.opts.gmatch)for(var g=0;g<b.length;g++)worker.postMessage({match:"true",blob:d[f],size:[c.fBeg,c.fEnd,g+1]});else worker.postMessage({match:"true",blob:d[f],size:[c.fBeg,c.fEnd]});else this.opts.showFailed&&worker.postMessage({match:"false",blob:d[f],size:[c.fBeg,c.fEnd]});else this.matchAll&&worker.postMessage({match:"true",blob:d[f],size:[c.fBeg,c.fEnd],query:c.opts.query})},epicTail.prototype.extend=function(a,b){var c=a||{},d=b||{};return function e(a,b){for(var c in b)"object"==typeof a[c]?e(a[c],b[c]):a[c]=b[c]}(c,d),c},epicTail.prototype.updateOpts=function(a){this.opts=this.extend(this.opts,a.data)},epicTail.prototype.html=function(a){return a=a.replace(/[<>]/g,function(a){return"<"===a?"&lt;":"&gt;"})};